#!/usr/bin/env bash

# Fail fast and fail hard.
set -feo pipefail

# shared logic
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
. "${SCRIPT_DIR}/../share/compile/common"

# common parameters
if [ $# -ne 2 ]
then
	echo "usage: create kit_name rsa_key"
	exit 2
fi

kit_name=$1
rsa_key=$2

if [ ! -f "${compiler_root}/$1/${version_file}" ] 
then
	echo "Requested compiler kit '$kit_name' does not exists."
	exit 3
fi

# generate new sandbox
sandbox_id=$(gen_token)

create_sandbox $kit_name $sandbox_id 
compile_kit_exec $sandbox_id "create"

echo "Created ${sandbox_id}"